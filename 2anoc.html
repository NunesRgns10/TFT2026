<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chamada Digital - 2º C</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f1f5f9;
            --text: #1e293b;
            --verde: #22c55e;
            --vermelho: #ef4444;
            --azul: #3b82f6;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 850px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        header { border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; color: var(--primary); font-size: 1.4rem; }
        
        .controls { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; font-weight: bold; }
        input[type="date"] { padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; outline: none; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { text-align: left; padding: 12px; color: #64748b; font-size: 0.9rem; text-transform: uppercase; }
        td { padding: 12px; background: #fff; border-top: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; }
        td:first-child { border-left: 1px solid #f1f5f9; border-radius: 8px 0 0 8px; font-weight: 500; }
        td:last-child { border-right: 1px solid #f1f5f9; border-radius: 0 8px 8px 0; text-align: right; }

        .btn-group { display: inline-flex; gap: 5px; }
        .status-btn { 
            border: 2px solid #e2e8f0; background: white; padding: 8px 15px; 
            border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.2s; color: #94a3b8;
        }

        .status-btn.p-active { border-color: var(--verde); background: var(--verde); color: white; }
        .status-btn.f-active { border-color: var(--vermelho); background: var(--vermelho); color: white; }
        .status-btn.fs-active { border-color: var(--azul); background: var(--azul); color: white; }

        .btn-finalizar { 
            margin-top: 30px; padding: 18px; background: var(--primary); color: white; 
            border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.1rem;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.4);
        }
        .btn-finalizar:hover { background: #1d4ed8; transform: translateY(-1px); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>2º Ano C - Chamada</h1>
        <div class="controls">
            <input type="date" id="dataAula">
        </div>
    </header>

    <table>
        <thead>
            <tr>
                <th>Estudante</th>
                <th style="text-align: right;">P / F / FS</th>
            </tr>
        </thead>
        <tbody id="listaAlunos"></tbody>
    </table>

    <button class="btn-finalizar" onclick="gerarRelatorioPDF()">Finalizar e Gerar PDF</button>
</div>

<script>
    const { jsPDF } = window.jspdf;

    const alunos = [
        "1. Ana Ketely Firmina Menezes", "2. Ana Larissa Souza Silva", "3. Ana Luiza de Souza Lima",
        "4. Ana Luiza Rodrigues", "5. Ana Larissa Souza Silva", "6. Ana Rayra Pessoa Santos",
        "7. Antonio Ismael Alves de Barros", "8. Bruna Kelly Silva Lima", "9. Carlos Eduardo Gadelha dos Santos",
        "10. Eduardo Facanha Holanda", "11. Ermerson Almeida de Sousa", "12. Giselly da Silva Alves",
        "13. Haroldo Aquiles Feitosa Silva", "14. Joao Matheus Santos Batista", "15. Luiz Gustavo Rocha de Lima Falcao",
        "16. Manoel Guilherme Carvalho Pinto da Silva", "17. Marcelo Ravy Sousa Oliveira", "18. Marcos Matheus Farias Martins",
        "19. Maria de Fatima Oliveira da Conceicao Rocha", "20. Maria Eduarda Araujo Bezerra", "21. Maria Julia Sousa",
        "22. Micaely Rodrigues Dantas", "23. Michael Mota Reis", "24. Michelly Marques Nascimento",
        "25. Miguel Rodrigues da Silva", "26. Paulo Rodrigo Alves de Sousa", "27. Pedro Henrique Sales Silva",
        "28. Pedro William Firmino de Lima", "29. Rebeca Araujo Gomes", "30. Robson Kayque Gadelha da Silva",
        "31. Sophie Almeida Gomes", "32. Thauany Natanaeli Guenm Gering", "33. Thayna dos Santos Feitosa",
        "34. Vitor Gabriel Pereira da Silva", "35. Maria Eduarda Lima Gregório", "36. Yanni Sophia Ferreira sa Silva Nunes",
        "37. pedro henrique nacimento sousa"
    ];

    const presencas = {};
    alunos.forEach((_, i) => presencas[i] = 'P');

    const tbody = document.getElementById('listaAlunos');

    function renderizarTabela() {
        tbody.innerHTML = '';
        alunos.forEach((aluno, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${aluno}</td>
                <td>
                    <div class="btn-group">
                        <button class="status-btn ${presencas[index] === 'P' ? 'p-active' : ''}" onclick="marcar(${index}, 'P')">P</button>
                        <button class="status-btn ${presencas[index] === 'F' ? 'f-active' : ''}" onclick="marcar(${index}, 'F')">F</button>
                        <button class="status-btn ${presencas[index] === 'FS' ? 'fs-active' : ''}" onclick="marcar(${index}, 'FS')">FS</button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function marcar(index, status) {
        presencas[index] = status;
        renderizarTabela();
    }

    document.getElementById('dataAula').valueAsDate = new Date();
    renderizarTabela();

    function gerarRelatorioPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // --- LÓGICA UNIVERSAL: Pega o nome da turma direto do título da página ---
        const nomeTurma = document.querySelector('h1').innerText.replace(' - Chamada', '');
        
        const dataSelecionada = document.getElementById('dataAula').value;
        const [ano, mes, dia] = dataSelecionada.split('-');
        const dataFormatada = `${dia}/${mes}/${ano}`;

        const faltosos = [];
        const presentes = [];

        alunos.forEach((aluno, index) => {
            const status = presencas[index];
            if (status === 'F' || status === 'FS') {
                faltosos.push([aluno, status === 'F' ? 'Falta' : 'Falta S.']);
            } else {
                presentes.push([aluno, 'Presente']);
            }
        });

        const fontSizeCorpo = 10;
        const fontSizeSubtitulo = 11;

        // Cabeçalho Principal Dinâmico
        doc.setFontSize(14);
        doc.setTextColor(37, 99, 235);
        doc.text(`Relatório de Chamada - ${nomeTurma}`, 14, 15);
        
        doc.setFontSize(fontSizeCorpo);
        doc.setTextColor(30, 41, 59);
        doc.text(`Data: ${dataFormatada}`, 14, 22);
        doc.text(`Total de Alunos na Turma: ${alunos.length}`, 14, 27);

        // --- SEÇÃO 1: AUSÊNCIAS ---
        doc.setFontSize(fontSizeSubtitulo);
        doc.setTextColor(239, 68, 68);
        doc.text(`Ausências (Total: ${faltosos.length})`, 14, 37);

        if (faltosos.length > 0) {
            doc.autoTable({
                startY: 40,
                head: [['Aluno', 'Situação']],
                body: faltosos,
                headStyles: { fillColor: [239, 68, 68], fontSize: fontSizeCorpo },
                styles: { fontSize: fontSizeCorpo },
                theme: 'grid'
            });
        } else {
            doc.setFontSize(fontSizeCorpo);
            doc.setTextColor(100);
            doc.text("Nenhuma ausência registrada.", 14, 45);
        }

        let finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY + 8 : 50;
        doc.setDrawColor(220, 220, 220);
        doc.line(14, finalY, 196, finalY);

        // --- SEÇÃO 2: PRESENÇAS ---
        doc.setFontSize(fontSizeSubtitulo);
        doc.setTextColor(34, 197, 94);
        doc.text(`Alunos Presentes (Total: ${presentes.length})`, 14, finalY + 8);

        if (presentes.length > 0) {
            doc.autoTable({
                startY: finalY + 12,
                head: [['Aluno', 'Situação']],
                body: presentes,
                headStyles: { fillColor: [34, 197, 94], fontSize: fontSizeCorpo },
                styles: { fontSize: fontSizeCorpo },
                theme: 'grid'
            });
        }

        // --- LINHA FINAL DE TOTALIZAÇÃO ---
        let resumoY = doc.lastAutoTable ? doc.lastAutoTable.finalY + 10 : finalY + 25;
        doc.setFontSize(fontSizeCorpo);
        doc.setTextColor(30, 41, 59);
        doc.setFont(undefined, 'bold');
        doc.text(`Resumo: ${presentes.length} Presentes | ${faltosos.length} Ausentes | Total: ${alunos.length} Alunos`, 14, resumoY);

        // Nome do arquivo também automático (ex: Chamada_3_Ano_B_2026-02-19.pdf)
        const nomeArquivo = nomeTurma.replace(/\s+/g, '_');
        doc.save(`Chamada_${nomeArquivo}_${dataSelecionada}.pdf`);
    }
</script>

</body>
</html>